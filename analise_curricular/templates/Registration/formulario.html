{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAUPE - An√°lise Curricular UPE 2025</title>
    <link rel="stylesheet" href="{% static 'CSS/style.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<header class="app-header">
    <h1>
        <img src="{% static 'images/logo.png' %}" alt="IAUPE" class="logo"> An√°lise Curricular
        {% if selecao_nome %}
            <span class="selection-name"> - {{ selecao_nome }}</span>
        {% endif %}
    </h1>
    <div class="candidate-counter">Candidato {{ indice_atual }} de {{ total_candidatos }}</div>
</header>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1><img src="{% static 'images/logo.png' %}" alt="IAUPE" class="logo"> An√°lise Curricular</h1>
            <div class="candidate-counter">Candidato {{ indice_atual }} de {{ total_candidatos }}</div>
        </header>

        <form method="post" enctype="multipart/form-data" class="evaluation-form">
            {% csrf_token %}
            
            <section class="candidate-card">
                <h2 class="section-title">Dados do Candidato</h2>
                <div class="candidate-info-group">
                    <div class="form-group">
                        <label for="{{ form.nome.id_for_label }}">Nome do Candidato:</label>
                        {{ form.nome }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.inscricao.id_for_label }}">N√∫mero de Inscri√ß√£o:</label>
                        {{ form.inscricao }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.cargo.id_for_label }}">Cargo/Fun√ß√£o:</label>
                        {{ form.cargo }}
                    </div>
                </div>
            </section>

            <section class="evaluation-section">
                <h2 class="section-title">Documentos do Candidato</h2>
                {% if documentos_candidato %}
                    <ul class="document-list">
                        {% for doc in documentos_candidato %}
                        <li>
                            <a href="{{ doc.url }}" target="_blank" class="document-link">
                                <span class="document-icon">üìÑ</span> {{ doc.nome }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="no-documents-message">Nenhum documento encontrado para este candidato.</p>
                {% endif %}
            </section>

            <section class="evaluation-section">
                <h2 class="section-title">{{ form.requisito.label }}</h2>
                <div class="form-group">
                    {{ form.requisito }} {# Renderiza o campo Select #}
                    {% if form.requisito.errors %}
                        <div class="form-error">{{ form.requisito.errors }}</div>
                    {% endif %}
                </div>
            </section>

            <section class="evaluation-section">
                <h2 class="section-title">{{ form.avaliacao.label }}</h2>
                <div class="form-group">
                    {{ form.avaliacao }} {# Renderiza o campo Select #}
                    {% if form.avaliacao.errors %}
                        <div class="form-error">{{ form.avaliacao.errors }}</div>
                    {% endif %}
                </div>

                <div id="justificativa-container" class="form-group" style="display: none;">
                    <label for="{{ form.justificativa.id_for_label }}">{{ form.justificativa.label }}:</label>
                    {{ form.justificativa }}
                    {% if form.justificativa.errors %}
                        <div class="form-error">{{ form.justificativa.errors }}</div>
                    {% endif %}
                </div>
            </section>

            <section class="evaluation-section">
                <h2 class="section-title">{{ form.observacao.label }}</h2>
                <div class="form-group">
                    {{ form.observacao }}
                    {% if form.observacao.errors %}
                        <div class="form-error">{{ form.observacao.errors }}</div>
                    {% endif %}
                </div>
            </section>

            <div class="form-navigation">
                {% if anterior_candidato_id %}
                    <a href="{% url 'analisar_candidato_com_id' anterior_candidato_id %}" class="nav-button prev">
                        &larr; Anterior
                    </a>
                {% else %}
                    <button type="button" class="nav-button prev disabled" disabled>
                        &larr; Anterior
                    </button>
                {% endif %}
                
                <button type="submit" class="nav-button next">
                    Pr√≥ximo &rarr;
                </button>
            </div>
        </form>

        <footer class="app-footer">
            <div class="footer-info">
                <span class="date-info">{{ data_hoje }}</span>
                <span class="system-info">Sistema de An√°lise Curricular - IAUPE</span>
            </div>
        </footer>
    </div>

    <div id="alertModal" class="modal">
        <div class="modal-content">
            <div class="modal-icon">‚ö†Ô∏è</div>
            <h3 class="modal-title" id="modalTitle">Aten√ß√£o</h3>
            <p class="modal-message" id="modalMessage"></p>
            <button class="modal-button" id="modalButton">Entendido</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos do formul√°rio
            const form = document.querySelector('.evaluation-form');
            // Mude para selecionar os campos Select
            const requisitoSelect = document.getElementById('id_requisito');
            const avaliacaoSelect = document.getElementById('id_avaliacao');
            const justificativaContainer = document.getElementById('justificativa-container');
            const justificativaTextarea = document.getElementById('id_justificativa');
            
            // Elementos do modal
            const modal = document.getElementById('alertModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalButton = document.getElementById('modalButton');
            
            // Mostrar/ocultar justificativa (adaptado para Select)
            function toggleJustificativa() {
                // Pega o valor selecionado do Select de avalia√ß√£o
                const selectedAvaliacaoValue = avaliacaoSelect.value;
                
                if (selectedAvaliacaoValue === 'Nao possui') {
                    justificativaContainer.style.display = 'block';
                    justificativaTextarea.required = true;
                } else {
                    justificativaContainer.style.display = 'none';
                    justificativaTextarea.required = false;
                    justificativaTextarea.value = ''; // Limpa o valor quando oculta
                }
            }
            
            // Mostrar modal de alerta
            function showAlert(title, message) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modal.style.display = 'flex';
            }
            
            // Event listeners (adaptado para Select)
            avaliacaoSelect.addEventListener('change', toggleJustificativa);
            
            requisitoSelect.addEventListener('change', function() {
                // Se a op√ß√£o selecionada for a placeholder, n√£o faz nada (ser√° validada no submit)
                if (this.value === '') { // O valor da op√ß√£o "Selecione uma op√ß√£o" √© vazio
                    return;
                }
                if (this.value === 'Sim') { // O valor da op√ß√£o "Sim" (atende aos requisitos)
                    showAlert(
                        'Candidato Eliminado', 
                        'Este candidato n√£o atende aos requisitos b√°sicos para o cargo conforme edital.'
                    );
                }
            });
            
            modalButton.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // Valida√ß√£o do formul√°rio (adaptado para Select)
            form.addEventListener('submit', function(e) {
                const selectedRequisitoValue = requisitoSelect.value;
                const selectedAvaliacaoValue = avaliacaoSelect.value;
                
                // Valida√ß√£o para "Requisitos para o Cargo" (valor vazio √© '')
                if (selectedRequisitoValue === '') {
                    e.preventDefault();
                    showAlert(
                        'Campo Obrigat√≥rio', 
                        'Por favor, selecione uma op√ß√£o em "Possui Requisitos para o Cargo?".'
                    );
                    return;
                }
                
                // Valida√ß√£o para "Avalia√ß√£o Curricular" (valor vazio √© '')
                if (selectedAvaliacaoValue === '') {
                    e.preventDefault();
                    showAlert(
                        'Campo Obrigat√≥rio', 
                        'Por favor, selecione uma op√ß√£o em "Avalia√ß√£o Curricular".'
                    );
                    return;
                }
                
                // Valida√ß√£o da Justificativa
                if (selectedAvaliacaoValue === 'Nao possui' && !justificativaTextarea.value.trim()) {
                    e.preventDefault();
                    showAlert(
                        'Justificativa Necess√°ria', 
                        'Por favor, informe a justificativa para "N√£o possui" na avalia√ß√£o curricular.'
                    );
                    return;
                }
            });
            
            // Inicializa√ß√£o
            toggleJustificativa();
            
            // Verifica se a justificativa deve ser exibida inicialmente
            if (avaliacaoSelect.value === 'Nao possui') {
                justificativaContainer.style.display = 'block';
            }
        });
    </script>
</body>
</html>